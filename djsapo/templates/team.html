{% extends "datatables.html" %}
{% block extra_javascript %}
{{block.super}}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-sortablejs@latest/jquery-sortable.js"></script>
<script>
$('#matrix-table').sortable({
    group: {
        name:'matrix',
        pull:['team']
    },
    animation: 150,
    sort: false,
    onAdd: function (evt) {
        console.log(evt);
    },
    onRemove: function (evt) {
        console.log(evt);
    }
});
$('#team-members').sortable({
    group: {
        name: 'team',
        put: ['matrix','facstaff'],
        pull: ['matrix','facstaff']
    },
    animation: 150,
    sort: false,
    filter: '.strike', // is not draggable
    onAdd: function (evt) {
        //console.log(evt['item']['firstElementChild']);
        $mid = evt['item']['firstElementChild']['dataset']['mid'];
        $midDom = $('[data-mid="' + $mid + '"]');
        $midDom.prepend('<a href="#" class="remove-member"><i class="fa fa-times red blue-tooltip" data-toggle="tooltip" data-placement="top" aria-hidden="true" title="Remove from the alert team"></i></a>');
        //console.log('mid=' + $midDom.html());
    },
    onRemove: function (evt) {
        //console.log(evt);
    }
});
$('#faculty-staff').sortable({
    group: {
        name: 'facstaff'
    },
    animation: 150,
    sort: false,
    filter: '.dataTables_empty', // is not draggable
    onAdd: function (evt) {
        console.log(evt);
    },
    onRemove: function (evt) {
        console.log(evt);
    }
});
</script>
{% endblock %}
{% block content %}
{% include "alert/student.header.inc.html" %}
<div class="container mb-4">
  <div class="row mb-3">
    <div class="col-lg-9">
      <h2>Team Manager</h2>
      <p>
        Click on a person's name and drag the it from one side to the other.
        To add someone to the team, drag them from the left and drop them on the right.
        To remove someone from the team, drag them from the right to drop them on the left.
      </p>
    </div>
    <!-- /.col-lg-8 -->
  </div>
  <!-- /.row -->
  <div class="row mb-3">
    <div class="col-lg-4">
      <h5>Suggested Team Members</h5>
      <div class="table-responsive">
        <table class="table table-bordered table-hover display compact data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Groups</th>
            </tr>
          </thead>
          <tbody id="matrix-table">
            {% for m in matrix %}
            <tr>
              <td nowrap data-mid="{{m.id}}">
                <i class="fa fa-arrows handle"></i>
                {{m.last_name}}, {{m.first_name}}
                {% if m.profile.case_manager %}
                  <i class="fa fa-star green blue-tooltip" title="Case Manager" aria-hidden="true"></i>
                {% endif %}
              </td>
              <td nowrap>
                {% for g in m.groups.all %}
                {% if 'Status' not in g.name %}
                {% if g.name != "CenterForStudentSuccess" %}
                {{g}}{% if not forloop.last %}, {% endif %}
                {% endif %}{% endif %}
                {% endfor %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- /.col-lg-4 -->
    <div class="col-lg-4">
      <h5>Assigned Team Members</h5>
      <div class="table-responsive">
        <table class="table table-bordered table-hover display compact data-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Groups</th>
            </tr>
          </thead>
          <tbody id="team-members">
            {% for m in data.team.all %}
            <tr{% if not  m.status %} class="strike"{% endif %}>
              <td nowrap data-mid="{{m.user.id}}">
                <span>
                  {% if m.status %}
                  <a href="#" class="remove-member"><i class="fa fa-times red blue-tooltip" data-toggle="tooltip" data-placement="top" aria-hidden="true" title="Remove {{m}} from the team"></i></a>
                  {% else %}
                    <i class="fa fa-ban red" data-toggle="tooltip" data-placement="top"
                    title="{{m}} is no longer a member of the team"
                    aria-hidden="true"></i>
                  {% endif %}
                  <i class="fa fa-arrows handle"></i>
                  {{m}}
                </span>
              </td>
              <td nowrap>
                <span>
                {% for g in m.user.groups.all %}
                {% if 'Status' not in g.name %}
                {{g.name}}{% if not forloop.last %}, {% endif %}
                {% endif %}
                {% endfor %}
                </span>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- /.col-lg-4 -->
    <div class="col-lg-4">
      <div class="table-responsive" id="facultyStaff">
        <table class="table table-bordered table-hover display compact faculty-staff">
          <thead>
            <tr>
              <th>Faculty/Staff</th>
            </tr>
          </thead>
          <tbody id="faculty-staff">
          {% for p in peeps %}
          <tr>
            <td nowrap data-mid="{{p.cid}}">
              <span>
                <i class="fa fa-arrows handle"></i> {{p.lastname}}, {{p.firstname}}
              </span>
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!-- /.col-lg-4 -->
  </div>
  <!-- /.row -->
</div>
<!-- /.container -->
{% endblock content %}
